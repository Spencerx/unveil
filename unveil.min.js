(function(){function o(a){var b=this,d=typeof this==="function",e=a.hasOwnProperty("constructor")?a.constructor:d?a.constructor=function(){b.apply(this,arguments)}:a.constructor=function(){};a.hasOwnProperty("extend")&&q(e,a.extend);e.prototype=a;e.extend=arguments.callee;if(d){e.prototype.__proto__=this.prototype;"extended"in this&&this.extended(e)}return e}function q(a,b){for(var d in b)if(b.hasOwnProperty(d))a[d]=b[d]}var c={};c.EPSILON=1.0E-4;c.MAX_FLOAT=3.4028235E38;c.MIN_FLOAT=-3.4028235E38;
c.MAX_INT=2147483647;c.MIN_INT=-2147483648;c.PI=Math.PI;c.TWO_PI=2*c.PI;c.HALF_PI=c.PI/2;c.THIRD_PI=c.PI/3;c.QUARTER_PI=c.PI/4;c.DEG_TO_RAD=c.PI/180;c.RAD_TO_DEG=180/c.PI;Object.extend=function(a){function b(){}b.prototype=a.prototype||a;return new b};Object.create=function(a){function b(){}b.prototype=a;return new b};Object.keys=function(a){var b=[],d;for(d in a)a.hasOwnProperty(d)&&b.push(d);return b};o.prototype=Function.prototype;o.prototype.include=function(a){q(this.prototype,a);"included"in
a&&a.included(this);return this};c.SortedHash=function(a){var b=this;this.data={};this.keyOrder=[];this.length=0;if(a instanceof Array)_.each(a,function(d,e){b.set(e,d)});else a instanceof Object&&_.each(a,function(d,e){b.set(e,d)})};c.SortedHash.prototype.clone=function(){var a=new c.SortedHash;a.length=this.length;_.each(this.data,function(b,d){a.data[d]=b});a.keyOrder=this.keyOrder.slice(0,this.keyOrder.length);return a};c.SortedHash.prototype.set=function(a,b){if(a===undefined)return this;if(!this.data[a]){this.keyOrder.push(a);
this.length+=1}this.data[a]=b;return this};c.SortedHash.prototype.get=function(a){return this.data[a]};c.SortedHash.prototype.del=function(a){if(this.data[a]){this.keyOrder.splice($.inArray(a,this.keyOrder),1);delete this.data[a];this.length-=1}return this};c.SortedHash.prototype.at=function(a){return this.data[this.keyOrder[a]]};c.SortedHash.prototype.first=function(){return this.at(0)};c.SortedHash.prototype.last=function(){return this.at(this.length-1)};c.SortedHash.prototype.key=function(a){return this.keyOrder[a]};
c.SortedHash.prototype.each=function(a){var b=this;_.each(this.keyOrder,function(d,e){a.call(b,e,b.data[d])});return this};c.SortedHash.prototype.eachKey=function(a){var b=this;_.each(this.keyOrder,function(d){a.call(b,d,b.data[d])});return this};c.SortedHash.prototype.values=function(){var a=[];this.eachKey(function(b,d){a.push(d)});return a};c.SortedHash.prototype.toArray=function(){var a=[];this.eachKey(function(b,d){a.push({key:b,value:d})});return a};c.SortedHash.prototype.map=function(a){var b=
this.clone(),d=this;b.each(function(e,f){b.data[d.key(e)]=a.call(b,f)});return b};c.SortedHash.prototype.select=function(a){var b=new c.SortedHash,d=this;this.eachKey(function(e,f){a.call(d,e,f)&&b.set(e,f)});return b};c.SortedHash.prototype.sort=function(a){var b=this.clone();sortedKeys=b.toArray().sort(a);b.keyOrder=$.map(sortedKeys,function(d){return d.key});return b};c.SortedHash.prototype.intersect=function(a){var b=new c.SortedHash;this.eachKey(function(d,e){a.eachKey(function(f){d===f&&b.set(d,
e)})});return b};c.SortedHash.prototype.union=function(a){var b=new c.SortedHash;this.eachKey(function(d,e){b.get(d)||b.set(d,e)});a.eachKey(function(d,e){b.get(d)||b.set(d,e)});return b};c.Aggregators={};c.Aggregators.SUM=function(a){var b=0;a.each(function(d,e){b+=e});return b};c.Aggregators.MIN=function(a){var b=Infinity;a.each(function(d,e){if(e<b)b=e});return b};c.Aggregators.MAX=function(a){var b=-Infinity;a.each(function(d,e){if(e>b)b=e});return b};c.Aggregators.AVG=function(a){return c.Aggregators.SUM(a)/
a.length};c.Aggregators.COUNT=function(a){return a.length};c.Comparators={};c.Comparators.ASC=function(a,b){return a.value===b.value?0:a.value<b.value?-1:1};c.Comparators.DESC=function(a,b){return a.value===b.value?0:a.value>b.value?-1:1};c.Node=function(a){this.nodeId=c.Node.generateId();if(a)this.val=a.value;this._properties={}};c.Node.prototype.identity=function(){return this.nodeId};c.Node.nodeCount=0;c.Node.generateId=function(){return c.Node.nodeCount+=1};c.Node.prototype.replace=function(a,
b){this._properties[a]=b};c.Node.prototype.set=function(a,b,d){this._properties[a]||(this._properties[a]=new c.SortedHash);this._properties[a].set(b,d instanceof c.Node?d:new c.Node({value:d}));return this};c.Node.prototype.get=function(a,b){if(b!==undefined&&this._properties[a]!==undefined)return this._properties[a].get(b)};c.Node.prototype.all=function(a){return this._properties[a]};c.Node.prototype.first=function(a){return(a=this._properties[a])?a.first():null};c.Node.prototype.value=function(a){return this.values(a).first()};
c.Node.prototype.values=function(a){if(!this.all(a))return new c.SortedHash;return this.all(a).map(function(b){return b.val})};c.Node.prototype.toString=function(){var a="Node#"+this.nodeId+" {\n",b=this;_.each(this._properties,function(d,e){a+="  "+e+": "+b.values(e).values()+"\n"});a+="}";return a};c.Value=function(a){c.Node.call(this,{value:a})};c.Value.prototype=Object.extend(c.Node);c.Value.prototype.clone=function(){var a=new c.Value(this.val);a.replace("items",new c.SortedHash);return a};c.Item=
function(a,b,d){var e=this;c.Node.call(this);this.key=b;$.each(d,function(f,i){var g=a.get("properties",f),j;$.isArray(i)||(i=[i]);$.each(i,function(h,l){var k;if(g.type==="collection"){k=new c.Collection({properties:g.collection_properties,items:l});j="collection"}else{k=g.registerValue(l);j=l;k.set("items",e.key,e)}e.set(f,h,k)})});this.collection=a;a.set("items",b,this)};c.Item.prototype=Object.extend(c.Node);c.Item.prototype.type=function(a){return this.collection.get("properties",a).type};c.Item.prototype.identify=
function(){return this.value("name")||this.value("source")||this.key};c.Property=function(a,b,d){c.Node.call(this);this.key=b;this.type=d.type;this.name=d.name;this.descr=d.descr;this.unique=d.unique;this.categories=d.categories;this.collection=a;if(d.properties)this.collection_properties=d.properties};c.Property.prototype=Object.extend(c.Node);c.Property.prototype.clone=function(a){a=new c.Property(a,this.key,{type:this.type,name:this.name});a.replace("values",new c.SortedHash);return a};c.Property.prototype.toString=
function(){return this.name};c.Property.prototype.aggregate=function(a){return a(this.values("values"))};c.Property.prototype.registerValue=function(a){var b=this.get("values",a);if(b===undefined){b=new c.Value(a);this.set("values",a,b)}return b};c.Collection=function(a){c.Node.call(this);var b=this;if(a){$.each(a.properties,function(d,e){var f=new c.Property(b,d,e);b.set("properties",d,f)});this.replace("items",new c.SortedHash);$.each(a.items,function(d,e){new c.Item(b,d,e,true)})}};c.Collection.transformers=
{};c.Collection.prototype=Object.extend(c.Node);c.Collection.prototype.filter=function(a){var b=new c.Collection;b.replace("items",a.items(this));this.all("properties").eachKey(function(d,e){var f=e.clone(b);e.all("values").eachKey(function(i,g){var j=b.all("items").intersect(g.all("items"));if(j.length>0){var h=g.clone();h.replace("items",j);f.set("values",i,h)}});b.set("properties",d,f)});return b};c.Collection.prototype.transform=function(a,b){return c.Collection.transformers[a].call(this,this,
b)};c.Criterion=function(a,b,d){this.operator=a;this.property=b;this.value=d;this.children=[]};c.Criterion.operators={};c.Criterion.operators.AND=function(a,b){if(b.length===0)return new c.SortedHash;for(var d=b[0].items(a),e=1;e<b.length;e++)d=d.intersect(b[e].items(a));return d};c.Criterion.operators.OR=function(a,b){for(var d=new c.SortedHash,e=0;e<b.length;e++)d=d.union(b[e].items(a));return d};c.Criterion.operators.CONTAINS=function(a,b,d){return a.get("properties",b).get("values",d).all("items")};
c.Criterion.operators.GT=function(a,b,d){a=a.get("properties",b).all("values");var e=new c.SortedHash;a=a.select(function(f,i){return i.val>=d});a.each(function(f,i){e=e.union(i.all("items"))});return e};c.Criterion.prototype.add=function(a){this.children.push(a);return this};c.Criterion.prototype.items=function(a){return this.operator==="AND"?c.Criterion.operators.AND(a,this.children):this.operator==="OR"?c.Criterion.operators.OR(a,this.children):c.Criterion.operators[this.operator](a,this.property,
this.value)};c.Collection.transformers.group=function(a,b){function d(g,j,h){var l=new c.SortedHash;g.eachKey(function(k,m){var n=m.value(j);l.set(n,n)});return Aggregators[h](l)}var e=new c.Collection,f=a.get("properties",b.property),i=f.all("values");a.all("properties").eachKey(function(g,j){if(j.key===f.key||j.type==="number"){var h=new c.Property(e,g,{type:j.type,name:j.name,unique:j.unique});e.set("properties",g,h)}});i.each(function(g,j){var h={},l=j.all("items");e.all("properties").eachKey(function(k){h[k]=
k===b.property?j.val:d(l,k,b.aggregator)});new c.Item(e,j.val,h)});return e};c.Collection.transformers.group.label="Group By";c.Collection.transformers.group.params={property:{name:"Property",type:"property"},aggregator:{name:"Aggregator Function",type:"aggregator"}};c.Collection.transformers.coOccurrences=function(a,b){function d(i,g){var j=i.all("items"),h=g.all("items");return j.intersect(h).length}if(!b.property||!b.knn)return a;var e={},f=a.get("properties",b.property).all("values");f.each(function(i,
g){e[g.val]={source:g.val,similar_items:{}};var j=[];f.each(function(l,k){var m=0.5*(d(g,k)/d(g,g)+d(k,g)/d(k,k));m>0&&g.val!==k.val&&j.push({name:k.val,number_of_cooccurrences:d(g,k),score:m})});j.sort(function(l,k){var m=l.score,n=k.score;return m===n?0:m>n?-1:1});j=j.slice(0,b.knn);var h={};$.each(j,function(l,k){h[k.name]=k});e[g.val].source=g.val;e[g.val].similar_items=h});return new c.Collection({properties:{source:{name:"Source",type:"string",unique:true},similar_items:{name:"Similar Items",
type:"collection",unique:true,properties:{name:{name:"Name",type:"string",unique:true},number_of_cooccurrences:{name:"Number of Co-occurrences",type:"number",unique:true},score:{name:"Similarity Score",type:"number",unique:true}}}},items:e})};c.Collection.transformers.coOccurrences.label="Similarity (COOC)";c.Collection.transformers.coOccurrences.params={property:{name:"Property",type:"property"},knn:{name:"K-nearest Neighbor",type:"number"}};c.Collection.transformers.coOccurrencesBaccigalupo=function(a,
b){function d(i,g,j){var h=i.all("items"),l=g.all("items");return h.intersect(l).select(function(k,m){var n;a:{for(n=0;n<m.values(b.property).length-j;n++)if(m.values(b.property).at(n)===i.val&&m.values(b.property).at(n+j+1)===g.val){n=true;break a}n=false}return n}).length}if(!b.property||!b.knn)return a;var e={},f=a.get("properties",b.property).all("values");f.each(function(i,g){e[g.val]={source:g.val,similar_items:{}};var j=[];f.each(function(l,k){var m=1*d(g,k,0)+0.8*d(g,k,1)+0.64*d(g,k,2);m>
0&&g.val!==k.val&&j.push({name:k.val,number_of_cooccurrences:0,score:m})});j.sort(function(l,k){var m=l.score,n=k.score;return m===n?0:m>n?-1:1});j=j.slice(0,b.knn);var h={};$.each(j,function(l,k){h[k.name]=k});e[g.val].source=g.val;e[g.val].similar_items=h});return new c.Collection({properties:{source:{name:"Source",type:"string",unique:true},similar_items:{name:"Similar Items",type:"collection",unique:true,properties:{name:{name:"Name",type:"string",unique:true},number_of_cooccurrences:{name:"Number of Co-occurrences",
type:"number",unique:true},score:{name:"Similarity Score",type:"number",unique:true}}}},items:e})};c.Collection.transformers.coOccurrencesBaccigalupo.label="Co-Occurrences Baccigalupo";c.Collection.transformers.coOccurrencesBaccigalupo.params={property:{name:"Property",type:"property"},knn:{name:"K-nearest Neighbor",type:"number"}};c.DataGraph=function(a){c.Node.call(this);var b=this;_.select(a,function(d,e){if(d.type==="type"){b.set("types",e,new c.Type(this,e,d));return true}return false});_.select(a,
function(d,e){if(d.type!=="type"){var f=b.get("resources",e)||new c.Resource(b,e,d);b.set("resources",e,f);b.get("types",d.type).set("resources",e,f);return true}return false});this.all("resources").each(function(d,e){e.build()})};c.DataGraph.prototype=Object.extend(c.Node);c.VALUE_TYPES=["string","number","date","datetime","location"];c.isValueType=function(a){return _.include(c.VALUE_TYPES,a)};c.Type=function(a,b,d){var e=this;c.Node.call(this);this.g=a;this.key=b;this.name=d.name;_.each(d.properties,
function(f,i){var g=new c.Node;g.key=i;g.unique=f.unique;g.name=f.name;g.expected_type=f.expected_type;g.replace("values",new c.SortedHash);g.isValueType=function(){return c.isValueType(g.expected_type)};g.isObjectType=function(){return!g.isValueType()};e.set("properties",i,g)})};c.Type.prototype=Object.extend(c.Node);c.Resource=function(a,b,d){c.Node.call(this);this.g=a;this.key=b;this.type=a.get("types",d.type);this.data=d};c.Resource.prototype=Object.extend(c.Node);c.Resource.prototype.build=function(){var a=
this;_.each(this.data.properties,function(b,d){var e=_.isArray(b)?b:[b],f=a.type.get("properties",d);f.isObjectType()?_.each(e,function(i){i=a.g.get("resources",i);a.set(f.key,i.key,i)}):_.each(e,function(i){var g=f.get("values",i);g||(g=new c.Node({value:i}));a.set(f.key,i,g);f.set("values",i,g)})})};c.Resource.prototype.get=function(a,b){var d=this.type.get("properties",a);if(!d)return null;return arguments.length===1?d.isObjectType()?d.unique?this.first(a):this.all(a):d.unique?this.value(a):this.values(a):
c.Node.prototype.get.call(this,a,b)};(function(){function a(d,e){return{x:d||0,y:e||0,add:function(f){return a(this.x+f.x,this.y+f.y)}}}function b(d,e,f,i,g,j){d=d!==undefined?d:1;i=i!==undefined?i:1;return{a:d,b:e||0,c:f||0,d:i,tx:g||0,ty:j||0,concat:function(h){return b(this.a*h.a+this.c*h.b,this.b*h.a+this.d*h.b,this.a*h.c+this.c*h.d,this.b*h.c+this.d*h.d,this.a*h.tx+this.c*h.ty+this.tx,this.b*h.tx+this.d*h.ty+this.ty)},deltaTransformPoint:function(h){return a(this.a*h.x+this.c*h.y,this.b*h.x+
this.d*h.y)},inverse:function(){var h=this.a*this.d-this.b*this.c;return b(this.d/h,-this.b/h,-this.c/h,this.a/h,(this.c*this.ty-this.d*this.tx)/h,(this.b*this.tx-this.a*this.ty)/h)},rotate:function(h,l){return this.concat(b.rotation(h,l))},scale:function(h,l,k){return this.concat(b.scale(h,l,k))},transformPoint:function(h){return a(this.a*h.x+this.c*h.y+this.tx,this.b*h.x+this.d*h.y+this.ty)},translate:function(h,l){return this.concat(b.translation(h,l))}}}a.distance=function(d,e){return Math.sqrt(Math.pow(e.x-
d.x,2)+Math.pow(e.y-d.y,2))};a.direction=function(d,e){return Math.atan2(e.y-d.y,e.x-d.x)};b.rotation=function(d,e){var f=b(Math.cos(d),Math.sin(d),-Math.sin(d),Math.cos(d));if(e)f=b.translation(e.x,e.y).concat(f).concat(b.translation(-e.x,-e.y));return f};b.scale=function(d,e,f){e=e||d;d=b(d,0,0,e);if(f)d=b.translation(f.x,f.y).concat(d).concat(b.translation(-f.x,-f.y));return d};b.translation=function(d,e){return b(1,0,0,1,d,e)};b.IDENTITY=b();b.HORIZONTAL_FLIP=b(-1,0,0,1);b.VERTICAL_FLIP=b(1,0,
0,-1);c.Point=a;c.Matrix=b})();c.Actor=function(a){c.Node.call(this);this.childCount=0;this.properties=_.extend({x:0,y:0,scaleX:1,scaleY:1,rotation:0,localX:0,localY:0,localScaleX:1,localScaleY:1,localRotation:0,fillStyle:"#000",strokeStyle:"#000",lineWidth:1,lineCap:"butt",lineJoin:"miter",globalAlpha:1,miterLimit:10,visible:true,preserveShape:false,sticky:false},a);this.replace("children",new c.SortedHash);this.tweens={};this.active=false;this.handlers={}};c.Actor.registeredActors={};c.Actor.prototype=
Object.extend(c.Node);c.Actor.prototype.bind=function(a,b){this.handlers[a]||(this.handlers[a]=[]);this.handlers[a].push(b)};c.Actor.prototype.trigger=function(a){var b=this;this.handlers[a]&&_.each(this.handlers[a],function(d){d.apply(b,[])})};c.Actor.create=function(a){var b=c.Actor.registeredActors[a.type];if(!b)throw"Actor type unregistered: '"+a.type+"'";return new b(a)};c.Actor.prototype.id=function(){return this.p("id")||this.nodeId};c.Actor.prototype.add=function(a){var b;b=a instanceof c.Actor?
a:c.Actor.create(a);if(!this.scene)throw"You can't add childs to actors that don't have a scene reference";this.scene.registerActor(b);this.set("children",b.id(),b);b.parent=this;b.init&&b.init();a.actors&&_.each(a.actors,function(d){b.add(d)})};c.Actor.prototype.remove=function(a){var b=this;if(a instanceof Function)_.each(this.traverse(),function(d){a(d)&&b.scene.remove(d.id())});else{if(this.get("children",a)){this.all("children").del(a);delete this.scene.actors[a];delete this.scene.interactiveActors[a]}this.all("children").each(function(d,
e){e.remove(a)})}};c.Actor.prototype.traverse=function(){return this.scene.properties.traverser(this)};c.Actor.prototype.property=function(a,b){if(b)return this.properties[a]=b;else return this.properties[a]instanceof Function?this.properties[a].call(this):this.properties[a]};c.Actor.prototype.p=c.Actor.prototype.property;c.Actor.prototype.animate=function(a,b,d,e){var f=this.scene;this.tweens[a]||(this.tweens[a]=new c.Tween({obj:this.properties,property:a,duration:d||1E3}));if(e)this.tweens[a].easer=
c.Tween[e];if(f.commands.RequestFramerate){this.tweens[a].bind("start",function(){f.execute(c.cmds.RequestFramerate)});this.tweens[a].bind("finish",function(){f.unexecute(c.cmds.RequestFramerate)})}this.tweens[a].continueTo(b,d||1E3);return this.tweens[a]};c.Actor.prototype.tWorldParent=function(){return this.parent?this.parent._tWorld:c.Matrix()};c.Actor.prototype.tWorld=function(){return c.Matrix().concat(this.tWorldParent()).translate(this.p("x"),this.p("y")).rotate(this.p("rotation")).scale(this.p("scaleX"),
this.p("scaleY"))};c.Actor.prototype.tShape=function(){return c.Matrix().translate(this.p("localX"),this.p("localY")).rotate(this.p("localRotation")).scale(this.p("localScaleX"),this.p("localScaleY"))};c.Actor.prototype.compileMatrix=function(){this.update();this._tWorld=this.tWorld();this.all("children")&&this.all("children").each(function(a,b){b.compileMatrix()})};c.Actor.prototype.tWorldView=function(a){a=this.properties.sticky?c.Matrix():a;if(this.properties.preserveShape){a=a.concat(this._tWorld);
a=a.transformPoint(c.Point(0,0));a=c.Matrix().translate(a.x,a.y).concat(this.tShape())}else a=this.tShape().concat(a).concat(this._tWorld);return a};c.Actor.prototype.update=function(){_.each(this.tweens,function(a){a.tick()})};c.Actor.prototype.applyStyles=function(a){a.fillStyle=this.p("fillStyle");a.strokeStyle=this.p("strokeStyle");a.lineWidth=this.p("lineWidth");a.lineCap=this.p("butt");a.lineJoin=this.p("lineJoin");a.globalAlpha=this.p("globalAlpha");a.miterLimit=this.p("miterLimit")};c.Actor.prototype.draw=
function(){};c.Actor.prototype.checkActive=function(a,b,d){b=new c.Point(b,d);d=this._tWorld.inverse().transformPoint(b);b=d.x;d=d.y;if(this.bounds&&a.isPointInPath){this.drawBounds(a);this.active=a.isPointInPath(b,d)?true:false}return this.active};c.Actor.prototype.drawBounds=function(a){var b=this.bounds(),d,e;d=b.shift();a.beginPath();for(a.moveTo(d.x,d.y);e=b.shift();)a.lineTo(e.x,e.y);a.lineTo(d.x,d.y)};c.Actor.prototype.render=function(a,b){var d=this.tWorldView(b);if(this.p("visible")){a.setTransform(d.a,
d.b,d.c,d.d,d.tx,d.ty);this.applyStyles(a);this.draw(a)}};c.traverser={};c.traverser.BreadthFirst=function(a){var b=[],d=[];for(b.push(a);b.length>0;){a=b.shift();if(a.p("visible")){d.push(a);a.all("children").each(function(e,f){b.push(f)})}}return d};c.traverser.DepthFirst=function(a){var b=[],d=[];for(b.push(a);b.length>0;){a=b.pop();if(a.p("visible")){d.push(a);a.all("children").each(function(e,f){b.push(f)})}}return d};c.behaviors={};c.behaviors.adjust=function(a,b){var d=a.bounds();if(a.bounded){b.a=
b.d=Math.max(1,b.a);b.tx=Math.max(d.x,Math.min(0,b.tx));b.ty=Math.max(d.y,Math.min(0,b.ty))}return b};c.behaviors.Zoom=function(a){a.$canvas.bind("mousewheel",function(b,d){var e=a.tView.scale(1+0.0050*d,1+0.0050*d,c.Point(a.scene.mouseX,a.scene.mouseY));a.tView=c.behaviors.adjust(a,e);a.callbacks.viewChange.call(a)})};c.behaviors.Pan=function(a){function b(){e=false}var d,e=false;a.$canvas.bind("mousedown",function(){p=c.Point(a.mouseX,a.mouseY);d=a.tView;e=true});a.$canvas.bind("mousemove",function(){if(e){var f=
c.Matrix.translation(a.mouseX-p.x,a.mouseY-p.y).concat(d);a.tView=c.behaviors.adjust(a,f)}});a.$canvas.bind("mouseup",b);a.$canvas.bind("mouseout",b)};c.Display=function(a,b){var d=this;this.scene=a;this.element=document.getElementById(b.container);this.canvas=document.createElement("canvas");this.canvas.setAttribute("width",b.width);this.canvas.setAttribute("height",b.height);this.canvas.style.position="relative";this.element.appendChild(this.canvas);this.$element=$(this.element);this.$canvas=$(this.canvas);
this.width=b.width;this.height=b.height;this.bounded=b.bounded||true;this.$element.append(this.$canvas);this.ctx=this.$canvas[0].getContext("2d");this.tView=c.Matrix();if(b.zooming)this.zoombehavior=new c.behaviors.Zoom(this);if(b.panning)this.panbehavior=new c.behaviors.Pan(this);this.callbacks={};this.callbacks.viewChange=function(){};this.$canvas.bind("mousemove",function(e){var f=d.tView.inverse();if(e.offsetX)pos=new c.Point(e.offsetX,e.offsetY);else if(e.layerX)pos=new c.Point(e.layerX,e.layerY);
if(pos){d.mouseX=pos.x;d.mouseY=pos.y;worldPos=f.transformPoint(pos);d.scene.mouseX=parseInt(worldPos.x,10);d.scene.mouseY=parseInt(worldPos.y,10);d.scene.activeDisplay=d}});this.$canvas.bind("mouseout",function(){d.scene.mouseX=NaN;d.scene.mouseY=NaN});this.$canvas.bind("click",function(){_.each(d.scene.activeActors,function(e){e.trigger("click")})})};c.Display.prototype.on=function(a,b){this.callbacks[a]=b};c.Display.prototype.displayPos=function(){return this.tView.transformPoint(pos)};c.Display.prototype.zoom=
function(){return this.tView.a};c.Display.prototype.worldPos=function(a){return this.tView.inverse().transformPoint(a)};c.Display.prototype.bounds=function(){return{x:(1-this.tView.a)*this.width,y:(1-this.tView.a)*this.height}};c.Display.prototype.refresh=function(){var a=this;this.ctx.clearRect(0,0,this.width,this.height);this.ctx.fillStyle=this.scene.p("fillStyle");this.ctx.fillRect(0,0,this.width,this.height);this.ctx.save();a.actors=this.scene.traverse();a.actors.shift();_.each(a.actors,function(b){b.render(a.ctx,
a.tView)});this.ctx.restore()};c.cmds={};c.cmds.RequestFramerate=function(a,b){this.scene=a;this.requests=0;this.framerate=b.framerate;this.originalFramerate=this.scene.framerate};c.cmds.RequestFramerate.className="RequestFramerate";c.cmds.RequestFramerate.prototype.execute=function(){this.requests+=1;this.scene.framerate=this.framerate};c.cmds.RequestFramerate.prototype.unexecute=function(){this.requests-=1;if(this.requests<=0)this.scene.framerate=this.originalFramerate};c.Scene=function(a){var b=
this;c.Actor.call(this,a);_.extend(this.properties,{width:0,height:0,fillStyle:"#fff",framerate:10,traverser:c.traverser.DepthFirst},a);this.mouseY=this.mouseX=NaN;this.interactiveActors={};this.activeActors=[];this.actors={};this.scene=this;this.displays=[];a.displays&&_.each(a.displays,function(d){b.displays.push(new c.Display(b,d))});this.activeDisplay=this.displays[0];this.fps=0;this.framerate=this.p("framerate");this.commands={};this.register(c.cmds.RequestFramerate,{framerate:60});a.actors&&
_.each(a.actors,function(d){b.add(d)})};c.Scene.prototype=Object.extend(c.Actor);c.Scene.prototype.registerActor=function(a){var b=a.id();if(this.actors[b])throw"ID '"+b+"' already registered.";a.scene=this;this.actors[b]=a;if(a.p("interactive"))this.interactiveActors[a.id()]=a};c.Scene.prototype.get=function(){return arguments.length===1?this.actors[arguments[0]]:c.Node.prototype.get.call(this,arguments[0],arguments[1])};c.Scene.prototype.start=function(a){_.extend({framerate:50,idleFramerate:10},
a);this.running=true;this.trigger("start");this.loop();this.checkActiveActors()};c.Scene.prototype.loop=function(){var a=this,b;if(this.running){b=(new Date).getTime();this.trigger("frame");this.compileMatrix();this.refreshDisplays();b=(new Date).getTime()-b;this.fps=1E3/b<a.framerate?1E3/b:a.framerate;setTimeout(function(){a.loop()},1E3/a.framerate-b)}};c.Scene.prototype.stop=function(){this.running=false;this.trigger("stop")};c.Scene.prototype.checkActiveActors=function(){var a=this.displays[0].ctx,
b=this,d=this.activeActors;if(this.running){if(this.scene.mouseX!==NaN){this.activeActors=[];_.each(this.interactiveActors,function(e){if(e.checkActive(a,b.scene.mouseX,b.scene.mouseY)){b.activeActors.push(e);_.include(d,e)||e.trigger("mouseover")}else _.include(d,e)&&e.trigger("mouseout")})}setTimeout(function(){b.checkActiveActors()},100)}};c.Scene.prototype.refreshDisplays=function(){_.each(this.displays,function(a){a.refresh()})};c.Scene.prototype.register=function(a,b){this.commands[a.className]=
new a(this,b)};c.Scene.prototype.execute=function(a){this.commands[a.className].execute()};c.Scene.prototype.unexecute=function(a){this.commands[a.className].unexecute()};c.Tween=function(a){this.prop=a.property;this.obj=a.obj;this._pos=this.begin=a.begin||a.obj[this.prop];this.setDuration(a.duration);this.easer=a.easer||c.Tween.strongEaseInOut;this.setFinish(a.finish||a.obj[this.prop]);this.handlers={}};c.Tween.prototype={obj:{},easer:function(a,b,d,e){return d*a/e+b},begin:0,change:0,prevTime:0,
prevPos:0,looping:false,_playing:false,_duration:0,_time:0,_pos:0,_position:0,_startTime:0,_finish:0,name:"",suffixe:"",bind:function(a,b){this.handlers[a]||(this.handlers[a]=[]);this.handlers[a].push(b)},trigger:function(a){var b=this;this.handlers[a]&&_.each(this.handlers[a],function(d){d.apply(b,[])})},setTime:function(a){this.prevTime=this._time;if(a>this.getDuration())if(this.looping){this.rewind(a-this._duration);this.update()}else{this._time=this._duration;this.update();this.stop()}else{if(a<
0)this.rewind();else this._time=a;this.update()}},getTime:function(){return this._time},setDuration:function(a){this._duration=a==null||a<=0?0.2:a/1E3},getDuration:function(){return this._duration},setPosition:function(a){this.prevPos=this._pos;this._pos=this.obj[this.prop]=a},getPosition:function(a){if(a==undefined)a=this._time;return this.easer(a,this.begin,this.change,this._duration)},setFinish:function(a){this.change=a-this.begin},getFinish:function(){return this.begin+this.change},isPlaying:function(){return this._playing},
init:function(a,b,d,e,f,i){if(arguments.length){this._listeners=[];this.addListener(this);this.obj=a;this.prop=b;this._pos=this.begin=e;this.setDuration(i);if(d!=null&&d!="")this.easer=d;this.setFinish(f)}},start:function(){this.rewind();this._playing=true;this.trigger("start")},rewind:function(a){this.reset();this._time=a==undefined?0:a;this.fixTime();this.update()},fforward:function(){this._time=this._duration;this.fixTime();this.update()},update:function(){this.setPosition(this.getPosition(this._time))},
tick:function(){this._playing&&this.nextFrame()},nextFrame:function(){this.setTime((this.getTimer()-this._startTime)/1E3)},reset:function(){this._playing=false},stop:function(){this._playing=false;this.trigger("finish")},continueTo:function(a,b){this.begin=this._pos;this.setFinish(a);this._duration!=undefined&&this.setDuration(b);this.start()},resume:function(){this.fixTime();this._playing=true},yoyo:function(){this.continueTo(this.begin,this._time)},fixTime:function(){this._startTime=this.getTimer()-
this._time*1E3},getTimer:function(){return(new Date).getTime()-this._time}};c.Tween.backEaseIn=function(a,b,d,e){if(f==undefined)var f=1.70158;return d*(a/=e)*a*((f+1)*a-f)+b};c.Tween.backEaseOut=function(a,b,d,e){if(f===undefined)var f=1.70158;return d*((a=a/e-1)*a*((f+1)*a+f)+1)+b};c.Tween.backEaseInOut=function(a,b,d,e){if(f==undefined)var f=1.70158;if((a/=e/2)<1)return d/2*a*a*(((f*=1.525)+1)*a-f)+b;return d/2*((a-=2)*a*(((f*=1.525)+1)*a+f)+2)+b};c.Tween.elasticEaseIn=function(a,b,d,e,f,i){if(a==
0)return b;if((a/=e)==1)return b+d;i||(i=e*0.3);if(!f||f<Math.abs(d)){f=d;d=i/4}else d=i/(2*Math.PI)*Math.asin(d/f);return-(f*Math.pow(2,10*(a-=1))*Math.sin((a*e-d)*2*Math.PI/i))+b};c.Tween.elasticEaseOut=function(a,b,d,e,f,i){var g;if(a==0)return b;if((a/=e)==1)return b+d;i||(i=e*0.3);if(!f||f<Math.abs(d)){f=d;g=i/4}else g=i/(2*Math.PI)*Math.asin(d/f);return f*Math.pow(2,-10*a)*Math.sin((a*e-g)*2*Math.PI/i)+d+b};c.Tween.elasticEaseInOut=function(a,b,d,e,f,i){var g;if(a==0)return b;if((a/=e/2)==2)return b+
d;i||(i=e*0.3*1.5);if(!f||f<Math.abs(d)){f=d;g=i/4}else g=i/(2*Math.PI)*Math.asin(d/f);if(a<1)return-0.5*f*Math.pow(2,10*(a-=1))*Math.sin((a*e-g)*2*Math.PI/i)+b;return f*Math.pow(2,-10*(a-=1))*Math.sin((a*e-g)*2*Math.PI/i)*0.5+d+b};c.Tween.bounceEaseOut=function(a,b,d,e){return(a/=e)<1/2.75?d*7.5625*a*a+b:a<2/2.75?d*(7.5625*(a-=1.5/2.75)*a+0.75)+b:a<2.5/2.75?d*(7.5625*(a-=2.25/2.75)*a+0.9375)+b:d*(7.5625*(a-=2.625/2.75)*a+0.984375)+b};c.Tween.bounceEaseIn=function(a,b,d,e){return d-Tween.bounceEaseOut(e-
a,0,d,e)+b};c.Tween.bounceEaseInOut=function(a,b,d,e){return a<e/2?Tween.bounceEaseIn(a*2,0,d,e)*0.5+b:Tween.bounceEaseOut(a*2-e,0,d,e)*0.5+d*0.5+b};c.Tween.strongEaseInOut=function(a,b,d,e){return d*(a/=e)*a*a*a*a+b};c.Tween.regularEaseIn=function(a,b,d,e){return d*(a/=e)*a+b};c.Tween.regularEaseOut=function(a,b,d,e){return-d*(a/=e)*(a-2)+b};c.Tween.regularEaseInOut=function(a,b,d,e){if((a/=e/2)<1)return d/2*a*a+b;return-d/2*(--a*(a-2)-1)+b};c.Tween.strongEaseIn=function(a,b,d,e){return d*(a/=e)*
a*a*a*a+b};c.Tween.strongEaseOut=function(a,b,d,e){return d*((a=a/e-1)*a*a*a*a+1)+b};c.Tween.strongEaseInOut=function(a,b,d,e){if((a/=e/2)<1)return d/2*a*a*a*a*a+b;return d/2*((a-=2)*a*a*a*a+2)+b};c.Rect=function(a){c.Actor.call(this,_.extend({width:0,height:0,fillStyle:"#777",strokeStyle:"#000",lineWidth:0},a))};c.Actor.registeredActors.rect=c.Rect;c.Rect.prototype=Object.extend(c.Actor);c.Rect.prototype.bounds=function(){return[{x:0,y:0},{x:this.p("width"),y:0},{x:this.p("width"),y:this.p("height")},
{x:0,y:this.p("height")}]};c.Rect.prototype.draw=function(a){this.p("fillStyle")&&a.fillRect(0,0,this.p("width"),this.p("height"));this.p("lineWidth")>0&&a.strokeRect(0,0,this.p("width"),this.p("height"))};c.Label=function(a){c.Actor.call(this,_.extend({text:"",textAlign:"start",font:"12px Helvetica, Arial",fillStyle:"#444",lineWidth:0,backgroundStyle:"#eee",background:false},a))};c.Actor.registeredActors.label=c.Label;c.Label.prototype=Object.extend(c.Actor);c.Label.prototype.draw=function(a){a.font=
this.p("font");if(this.p("background")){var b=a.measureText(this.p("text")).width;a.fillStyle=this.p("backgroundStyle");var d,e,f,i;if(this.p("textAlign")=="start"){d=-5;e=-13;f=b+10;i=20}else if(this.p("textAlign")=="center"){d=-b/2-5;e=-13;f=b+10;i=20}else if(this.p("textAlign")=="right"){d=-b-5;e=-13;f=b+10;i=20}(function(g,j,h,l,k,m,n){g.beginPath();g.moveTo(j+m,h);g.lineTo(j+l-m,h);g.quadraticCurveTo(j+l,h,j+l,h+m);g.lineTo(j+l,h+k-m);g.quadraticCurveTo(j+l,h+k,j+l-m,h+k);g.lineTo(j+m,h+k);g.quadraticCurveTo(j,
h+k,j,h+k-m);g.lineTo(j,h+m);g.quadraticCurveTo(j,h,j+m,h);g.closePath();n&&g.stroke();g.fill()})(a,d,e,f,i,5,this.p("lineWidth")>0)}a.textAlign=this.p("textAlign");a.fillText(this.p("text"),0,0)};c.Circle=function(a){c.Actor.call(this,_.extend({radius:20,strokeWeight:2,lineWidth:3,strokeStyle:"#fff"},a))};c.Actor.registeredActors.circle=c.Circle;c.Circle.prototype=Object.extend(c.Actor);c.Circle.prototype.bounds=function(){return[{x:-this.p("radius"),y:-this.p("radius")},{x:this.p("radius"),y:-this.p("radius")},
{x:this.p("radius"),y:this.p("radius")},{x:-this.p("radius"),y:this.p("radius")}]};c.Circle.prototype.draw=function(a){a.fillStyle=this.p("fillStyle");a.strokeStyle=this.p("strokeStyle");a.lineWidth=this.p("lineWidth");a.beginPath();a.arc(0,0,this.p("radius"),0,Math.PI*2,false);a.closePath();this.p("lineWidth")>0&&a.stroke();a.fill()};c.Path=function(a){c.Actor.call(this,_.extend({points:[],lineWidth:1,strokeStyle:"#000",fillStyle:null},a))};c.Actor.registeredActors.path=c.Path;c.Path.prototype=Object.extend(c.Actor);
c.Path.prototype.draw=function(a){var b=[].concat(this.p("points")),d;if(this.p("points").length>=1){a.beginPath();d=b.shift();for(a.moveTo(d.x,d.y);d=b.shift();)a.lineTo(d.x,d.y);this.p("fillStyle")&&a.fill();this.p("strokeStyle")&&a.stroke();a.closePath()}};c.Visualization=new o({constructor:function(a,b){this.collection=a;this.measures=b.measures;this.params=b.params;this.$canvas=b.canvas||$("#canvas");this.margin={top:20,right:20,bottom:20,left:20}},isValid:function(){var a=this,b=0,d=true;$.each(this.constructor.spec.measures,
function(e,f){var i;i=f.cardinality==="*"?a.measures.length-b:f.cardinality;for(var g=0;g<i;g++){var j;j=f;var h=a.property(b);j=j.optional&&!h?true:h&&j.types.indexOf(h.type)>=0&&(h.unique===j.unique||j.unique===undefined);j||(d=false);b+=1}});return b>=this.measures.length?d:false},property:function(a){return this.collection.get("properties",this.measures[a])},render:function(){this.$canvas.html("render() is not implemented.")}});if(this!=="undefined")this.uv=c;if(typeof exports!=="undefined")exports.uv=
c})();
