(function(B,q){function v(a){var b=this,d=typeof this==="function",e=a.hasOwnProperty("constructor")?a.constructor:d?a.constructor=function(){b.apply(this,arguments)}:a.constructor=function(){};a.hasOwnProperty("extend")&&w(e,a.extend);e.prototype=a;e.extend=arguments.callee;if(d){e.prototype.__proto__=this.prototype;"extended"in this&&this.extended(e)}return e}function w(a,b){for(var d in b)if(b.hasOwnProperty(d))a[d]=b[d]}var c={};c.EPSILON=1.0E-4;c.MAX_FLOAT=3.4028235E38;c.MIN_FLOAT=-3.4028235E38;
c.MAX_INT=2147483647;c.MIN_INT=-2147483648;c.PI=Math.PI;c.TWO_PI=2*c.PI;c.HALF_PI=c.PI/2;c.THIRD_PI=c.PI/3;c.QUARTER_PI=c.PI/4;c.DEG_TO_RAD=c.PI/180;c.RAD_TO_DEG=180/c.PI;Object.extend=function(a){function b(){}b.prototype=a.prototype||a;return new b};Object.create=function(a){function b(){}b.prototype=a;return new b};if(!Array.prototype.eachItem)Array.prototype.eachItem=function(a,b){var d=this.length||0,e;for(e=0;e<d;e+=1)e in this&&a.call(b,this[e],e,this)};Object.keys=function(a){var b=[],d;for(d in a)a.hasOwnProperty(d)&&
b.push(d);return b};v.prototype=Function.prototype;v.prototype.include=function(a){w(this.prototype,a);"included"in a&&a.included(this);return this};c.Aggregators={};c.Aggregators.SUM=function(a){var b=0;a.each(function(d,e){b+=e});return b};c.Aggregators.MIN=function(a){var b=Infinity;a.each(function(d,e){if(e<b)b=e});return b};c.Aggregators.MAX=function(a){var b=-Infinity;a.each(function(d,e){if(e>b)b=e});return b};c.Aggregators.AVG=function(a){return c.Aggregators.SUM(a)/a.length};c.Aggregators.COUNT=
function(a){return a.length};c.Comparators={};c.Comparators.ASC=function(a,b){return a.value===b.value?0:a.value<b.value?-1:1};c.Comparators.DESC=function(a,b){return a.value===b.value?0:a.value>b.value?-1:1};c.SortedHash=function(a){var b=this;this.data={};this.keyOrder=[];this.length=0;if(a instanceof Array)$.each(a,function(d,e){b.set(d,e)});else a instanceof Object&&$.each(a,function(d,e){b.set(d,e)})};c.SortedHash.prototype.clone=function(){var a=new c.SortedHash;a.length=this.length;$.each(this.data,
function(b,d){a.data[b]=d});a.keyOrder=this.keyOrder.slice(0,this.keyOrder.length);return a};c.SortedHash.prototype.set=function(a,b){if(a===null||a===q)return this;if(!this.data[a]){this.keyOrder.push(a);this.length+=1}this.data[a]=b;return this};c.SortedHash.prototype.get=function(a){return this.data[a]};c.SortedHash.prototype.del=function(a){if(this.data[a]){this.keyOrder.splice($.inArray(a,this.keyOrder),1);delete this.data[a];this.length-=1}return this};c.SortedHash.prototype.at=function(a){return this.data[this.keyOrder[a]]};
c.SortedHash.prototype.first=function(){return this.at(0)};c.SortedHash.prototype.last=function(){return this.at(this.length-1)};c.SortedHash.prototype.key=function(a){return this.keyOrder[a]};c.SortedHash.prototype.each=function(a){var b=this;$.each(this.keyOrder,function(d,e){a.call(b,d,b.data[e])});return this};c.SortedHash.prototype.eachKey=function(a){var b=this;$.each(this.keyOrder,function(d,e){a.call(b,e,b.data[e])});return this};c.SortedHash.prototype.values=function(){var a=[];this.eachKey(function(b,
d){a.push(d)});return a};c.SortedHash.prototype.toArray=function(){var a=[];this.eachKey(function(b,d){a.push({key:b,value:d})});return a};c.SortedHash.prototype.map=function(a){var b=this.clone(),d=this;b.each(function(e,f){b.data[d.key(e)]=a.call(b,f)});return b};c.SortedHash.prototype.select=function(a){var b=new c.SortedHash,d=this;this.eachKey(function(e,f){a.call(d,e,f)&&b.set(e,f)});return b};c.SortedHash.prototype.sort=function(a){var b=this.clone();sortedKeys=b.toArray().sort(a);b.keyOrder=
$.map(sortedKeys,function(d){return d.key});return b};c.SortedHash.prototype.intersect=function(a){var b=new c.SortedHash;this.eachKey(function(d,e){a.eachKey(function(f){d===f&&b.set(d,e)})});return b};c.SortedHash.prototype.union=function(a){var b=new c.SortedHash;this.eachKey(function(d,e){b.get(d)||b.set(d,e)});a.eachKey(function(d,e){b.get(d)||b.set(d,e)});return b};c.Node=function(a){this.id=c.Node.generateId();if(a)this.val=a.value;this._properties={}};c.Node.prototype.identity=function(){return this.id};
c.Node.nodeCount=0;c.Node.generateId=function(){return c.Node.nodeCount+=1};c.Node.prototype.replace=function(a,b){this._properties[a]=b};c.Node.prototype.set=function(a,b,d){this._properties[a]||(this._properties[a]=new c.SortedHash);this._properties[a].set(b,d instanceof c.Node?d:new c.Node({value:d}));return this};c.Node.prototype.get=function(a,b){if(b&&this._properties[a]!==q)return this._properties[a].get(b)};c.Node.prototype.all=function(a){return this._properties[a]};c.Node.prototype.first=
function(a){return(a=this._properties[a])?a.first():null};c.Node.prototype.value=function(a){return this.values(a).first()};c.Node.prototype.values=function(a){if(!this.all(a))return new c.SortedHash;return this.all(a).map(function(b){return b.val})};c.Node.prototype.toString=function(){var a="Node#"+this.id+" {\n",b=this;$.each(this._properties,function(d){a+="  "+d+": "+b.values(d).values()+"\n"});a+="}";return a};c.Value=function(a){c.Node.call(this,{value:a})};c.Value.prototype=Object.extend(c.Node);
c.Value.prototype.clone=function(){var a=new c.Value(this.val);a.replace("items",new c.SortedHash);return a};c.Item=function(a,b,d){var e=this;c.Node.call(this);this.key=b;$.each(d,function(f,h){var g=a.get("properties",f),j;$.isArray(h)||(h=[h]);$.each(h,function(m,o){var k;if(g.type==="collection"){k=new c.Collection({properties:g.collection_properties,items:o});j="collection"}else{k=g.registerValue(o);j=o;k.set("items",e.key,e)}e.set(f,j,k)})});this.collection=a;a.set("items",b,this)};c.Item.prototype=
Object.extend(c.Node);c.Item.prototype.type=function(a){return this.collection.get("properties",a).type};c.Item.prototype.identify=function(){return this.value("name")||this.value("source")||this.key};c.Property=function(a,b,d){c.Node.call(this);this.key=b;this.type=d.type;this.name=d.name;this.descr=d.descr;this.unique=d.unique;this.categories=d.categories;this.collection=a;if(d.properties)this.collection_properties=d.properties};c.Property.prototype=Object.extend(c.Node);c.Property.prototype.clone=
function(a){a=new c.Property(a,this.key,{type:this.type,name:this.name});a.replace("values",new c.SortedHash);return a};c.Property.prototype.toString=function(){return this.name};c.Property.prototype.aggregate=function(a){return a(this.values("values"))};c.Property.prototype.registerValue=function(a){var b=this.get("values",a);if(b===q){b=new c.Value(a);this.set("values",a,b)}return b};c.Collection=function(a){c.Node.call(this);var b=this;if(a){$.each(a.properties,function(d,e){var f=new c.Property(b,
d,e);b.set("properties",d,f)});this.replace("items",new c.SortedHash);$.each(a.items,function(d,e){new c.Item(b,d,e,true)})}};c.Collection.transformers={};c.Collection.prototype=Object.extend(c.Node);c.Collection.prototype.filter=function(a){var b=new c.Collection;b.replace("items",a.items(this));this.all("properties").eachKey(function(d,e){var f=e.clone(b);e.all("values").eachKey(function(h,g){var j=b.all("items").intersect(g.all("items"));if(j.length>0){var m=g.clone();m.replace("items",j);f.set("values",
h,m)}});b.set("properties",d,f)});return b};c.Collection.prototype.transform=function(a,b){return c.Collection.transformers[a].call(this,this,b)};c.Criterion=function(a,b,d){this.operator=a;this.property=b;this.value=d;this.children=[]};c.Criterion.operators={};c.Criterion.operators.AND=function(a,b){if(b.length===0)return new c.SortedHash;for(var d=b[0].items(a),e=1;e<b.length;e++)d=d.intersect(b[e].items(a));return d};c.Criterion.operators.OR=function(a,b){for(var d=new c.SortedHash,e=0;e<b.length;e++)d=
d.union(b[e].items(a));return d};c.Criterion.operators.CONTAINS=function(a,b,d){return a.get("properties",b).get("values",d).all("items")};c.Criterion.operators.GT=function(a,b,d){a=a.get("properties",b).all("values");var e=new c.SortedHash;a=a.select(function(f,h){return h.val>=d});a.each(function(f,h){e=e.union(h.all("items"))});return e};c.Criterion.prototype.add=function(a){this.children.push(a);return this};c.Criterion.prototype.items=function(a){return this.operator==="AND"?c.Criterion.operators.AND(a,
this.children):this.operator==="OR"?c.Criterion.operators.OR(a,this.children):c.Criterion.operators[this.operator](a,this.property,this.value)};c.Collection.transformers.group=function(a,b){function d(g,j,m){var o=new c.SortedHash;g.eachKey(function(k,n){var p=n.value(j);o.set(p,p)});return Aggregators[m](o)}var e=new c.Collection,f=a.get("properties",b.property),h=f.all("values");a.all("properties").eachKey(function(g,j){if(j.key===f.key||j.type==="number"){var m=new c.Property(e,g,{type:j.type,
name:j.name,unique:j.unique});e.set("properties",g,m)}});h.each(function(g,j){var m={},o=j.all("items");e.all("properties").eachKey(function(k){m[k]=k===b.property?j.val:d(o,k,b.aggregator)});new c.Item(e,j.val,m)});return e};c.Collection.transformers.group.label="Group By";c.Collection.transformers.group.params={property:{name:"Property",type:"property"},aggregator:{name:"Aggregator Function",type:"aggregator"}};c.Collection.transformers.coOccurrences=function(a,b){function d(h,g){var j=h.all("items"),
m=g.all("items");return j.intersect(m).length}if(!b.property||!b.knn)return a;var e={},f=a.get("properties",b.property).all("values");f.each(function(h,g){e[g.val]={source:g.val,similar_items:{}};var j=[];f.each(function(o,k){var n=0.5*(d(g,k)/d(g,g)+d(k,g)/d(k,k));n>0&&g.val!==k.val&&j.push({name:k.val,number_of_cooccurrences:d(g,k),score:n})});j.sort(function(o,k){var n=o.score,p=k.score;return n===p?0:n>p?-1:1});j=j.slice(0,b.knn);var m={};$.each(j,function(o,k){m[k.name]=k});e[g.val].source=g.val;
e[g.val].similar_items=m});return new c.Collection({properties:{source:{name:"Source",type:"string",unique:true},similar_items:{name:"Similar Items",type:"collection",unique:true,properties:{name:{name:"Name",type:"string",unique:true},number_of_cooccurrences:{name:"Number of Co-occurrences",type:"number",unique:true},score:{name:"Similarity Score",type:"number",unique:true}}}},items:e})};c.Collection.transformers.coOccurrences.label="Similarity (COOC)";c.Collection.transformers.coOccurrences.params=
{property:{name:"Property",type:"property"},knn:{name:"K-nearest Neighbor",type:"number"}};c.Collection.transformers.coOccurrencesBaccigalupo=function(a,b){function d(h,g,j){var m=h.all("items"),o=g.all("items");return m.intersect(o).select(function(k,n){var p;a:{for(p=0;p<n.values(b.property).length-j;p++)if(n.values(b.property).at(p)===h.val&&n.values(b.property).at(p+j+1)===g.val){p=true;break a}p=false}return p}).length}if(!b.property||!b.knn)return a;var e={},f=a.get("properties",b.property).all("values");
f.each(function(h,g){e[g.val]={source:g.val,similar_items:{}};var j=[];f.each(function(o,k){var n=1*d(g,k,0)+0.8*d(g,k,1)+0.64*d(g,k,2);n>0&&g.val!==k.val&&j.push({name:k.val,number_of_cooccurrences:0,score:n})});j.sort(function(o,k){var n=o.score,p=k.score;return n===p?0:n>p?-1:1});j=j.slice(0,b.knn);var m={};$.each(j,function(o,k){m[k.name]=k});e[g.val].source=g.val;e[g.val].similar_items=m});return new c.Collection({properties:{source:{name:"Source",type:"string",unique:true},similar_items:{name:"Similar Items",
type:"collection",unique:true,properties:{name:{name:"Name",type:"string",unique:true},number_of_cooccurrences:{name:"Number of Co-occurrences",type:"number",unique:true},score:{name:"Similarity Score",type:"number",unique:true}}}},items:e})};c.Collection.transformers.coOccurrencesBaccigalupo.label="Co-Occurrences Baccigalupo";c.Collection.transformers.coOccurrencesBaccigalupo.params={property:{name:"Property",type:"property"},knn:{name:"K-nearest Neighbor",type:"number"}};c.Vector=function(a,b,d){this.x=
a||0;this.y=b||0;this.z=d||0};c.Vector.angleBetween=function(a,b){return Math.acos(a.dot(b)/(a.mag()*b.mag()))};c.Vector.prototype={set:function(a,b,d){if(arguments.length===1)this.set(a.x||a[0],a.y||a[1],a.z||a[2]);else{this.x=a;this.y=b;this.z=d}},get:function(){return new c.Vector(this.x,this.y,this.z)},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},add:function(a,b,d){if(arguments.length===3){this.x+=a;this.y+=b;this.z+=d}else if(arguments.length===1){this.x+=a.x;
this.y+=a.y;this.z+=a.z}},sub:function(a,b,d){if(arguments.length===3){this.x-=a;this.y-=b;this.z-=d}else if(arguments.length===1){this.x-=a.x;this.y-=a.y;this.z-=a.z}},mult:function(a){if(typeof a==="number"){this.x*=a;this.y*=a;this.z*=a}else if(typeof a==="object"){this.x*=a.x;this.y*=a.y;this.z*=a.z}},div:function(a){if(typeof a==="number"){this.x/=a;this.y/=a;this.z/=a}else if(typeof a==="object"){this.x/=a.x;this.y/=a.y;this.z/=a.z}},dist:function(a){var b=this.x-a.x,d=this.y-a.y;a=this.z-a.z;
return Math.sqrt(b*b+d*d+a*a)},dot:function(a,b,d){var e;if(arguments.length===3)e=this.x*a+this.y*b+this.z*d;else if(arguments.length===1)e=this.x*a.x+this.y*a.y+this.z*a.z;return e},cross:function(a){return new c.Vector(this.y*a.z-a.y*this.z,this.z*a.x-a.z*this.x,this.x*a.y-a.x*this.y)},normalize:function(){var a=this.mag();a>0&&this.div(a)},limit:function(a){if(this.mag()>a){this.normalize();this.mult(a)}},heading2D:function(){return-Math.atan2(-this.y,this.x)},toString:function(){return"["+this.x+
", "+this.y+", "+this.z+"]"},array:function(){return[this.x,this.y,this.z]}};c.printMatrixHelper=function(a){for(var b=0,d=0;d<a.length;d++)b=d!==0?Math.max(b,Math.abs(a[d])):Math.abs(a[d]);a=(b+" ").indexOf(".");if(a===0)a=1;else if(a===-1)a=(b+" ").length;return a};c.Matrix2D=function(){if(arguments.length===0)this.reset();else if(arguments.length===1&&arguments[0]instanceof c.Matrix2D)this.set(arguments[0].array());else arguments.length===6&&this.set(arguments[0],arguments[1],arguments[2],arguments[3],
arguments[4],arguments[5])};c.Matrix2D.prototype={set:function(){if(arguments.length===6){var a=arguments;this.set([a[0],a[1],a[2],a[3],a[4],a[5]])}else if(arguments.length===1&&arguments[0]instanceof c.Matrix2D)this.elements=arguments[0].array();else if(arguments.length===1&&arguments[0]instanceof Array)this.elements=arguments[0].slice()},get:function(){var a=new pv.Matrix2D;a.set(this.elements);return a},reset:function(){this.set([1,0,0,0,1,0])},array:function(){return this.elements.slice()},translate:function(a,
b){this.elements[2]=a*this.elements[0]+b*this.elements[1]+this.elements[2];this.elements[5]=a*this.elements[3]+b*this.elements[4]+this.elements[5]},transpose:function(){},mult:function(a,b){var d,e;if(a instanceof c.Vector){d=a.x;e=a.y;b||(b=new c.Vector)}else if(a instanceof Array){d=a[0];e=a[1];b||(b=[])}if(b instanceof Array){b[0]=this.elements[0]*d+this.elements[1]*e+this.elements[2];b[1]=this.elements[3]*d+this.elements[4]*e+this.elements[5]}else if(b instanceof c.Vector){b.x=this.elements[0]*
d+this.elements[1]*e+this.elements[2];b.y=this.elements[3]*d+this.elements[4]*e+this.elements[5];b.z=0}return b},multX:function(a,b){return a*this.elements[0]+b*this.elements[1]+this.elements[2]},multY:function(a,b){return a*this.elements[3]+b*this.elements[4]+this.elements[5]},skewX:function(a){this.apply(1,0,1,a,0,0)},skewY:function(a){this.apply(1,0,1,0,a,0)},determinant:function(){return this.elements[0]*this.elements[4]-this.elements[1]*this.elements[3]},inverse:function(){var a=new c.Matrix2D(this);
return a.invert()?a:null},invert:function(){var a=this.determinant();if(Math.abs(a)>c.MIN_FLOAT){var b=this.elements[0],d=this.elements[1],e=this.elements[2],f=this.elements[3],h=this.elements[4],g=this.elements[5];this.elements[0]=h/a;this.elements[3]=-f/a;this.elements[1]=-d/a;this.elements[4]=b/a;this.elements[2]=(d*g-h*e)/a;this.elements[5]=(f*e-b*g)/a;return true}return false},scale:function(a,b){if(a&&!b)b=a;if(a&&b){this.elements[0]*=a;this.elements[1]*=b;this.elements[3]*=a;this.elements[4]*=
b}},apply:function(){if(arguments.length===1&&arguments[0]instanceof c.Matrix2D)this.apply(arguments[0].array());else if(arguments.length===6){var a=arguments;this.apply([a[0],a[1],a[2],a[3],a[4],a[5]])}else if(arguments.length===1&&arguments[0]instanceof Array){a=arguments[0];for(var b=[0,0,this.elements[2],0,0,this.elements[5]],d=0,e=0;e<2;e++)for(var f=0;f<3;f++,d++)b[d]+=this.elements[e*3+0]*a[f+0]+this.elements[e*3+1]*a[f+3];this.elements=b.slice()}},preApply:function(){if(arguments.length===
1&&arguments[0]instanceof c.Matrix2D)this.preApply(arguments[0].array());else if(arguments.length===6){var a=arguments;this.preApply([a[0],a[1],a[2],a[3],a[4],a[5]])}else if(arguments.length===1&&arguments[0]instanceof Array){a=arguments[0];var b=[0,0,a[2],0,0,a[5]];b[2]=a[2]+this.elements[2]*a[0]+this.elements[5]*a[1];b[5]=a[5]+this.elements[2]*a[3]+this.elements[5]*a[4];b[0]=this.elements[0]*a[0]+this.elements[3]*a[1];b[3]=this.elements[0]*a[3]+this.elements[3]*a[4];b[1]=this.elements[1]*a[0]+this.elements[4]*
a[1];b[4]=this.elements[1]*a[3]+this.elements[4]*a[4];this.elements=b.slice()}},rotate:function(a){var b=Math.cos(a);a=Math.sin(a);var d=this.elements[0],e=this.elements[1];this.elements[0]=b*d+a*e;this.elements[1]=-a*d+b*e;d=this.elements[3];e=this.elements[4];this.elements[3]=b*d+a*e;this.elements[4]=-a*d+b*e},rotateZ:function(a){this.rotate(a)},toString:function(){c.printMatrixHelper(this.elements);var a="";a+="["+this.elements[0]+" "+this.elements[1]+" "+this.elements[2]+" ]\n";a+="["+this.elements[3]+
" "+this.elements[4]+" "+this.elements[5]+" ]\n\n";return a}};c.Actor=function(a){c.Node.call(this);this.childCount=0;this.properties={x:0,y:0,scaleX:1,scaleY:1,rotation:0,fillStyle:"#000",strokeStyle:"#000",visible:true};_.extend(this.properties,a);this.active=false;this.matrix=new c.Matrix2D};c.Actor.prototype=Object.extend(c.Node);c.Actor.prototype.property=function(a,b){if(b)return this.properties[a]=b;else return this.properties[a]instanceof Function?this.properties[a].call(this):this.properties[a]};
c.Actor.prototype.prop=c.Actor.prototype.property;c.Actor.prototype.p=c.Actor.prototype.property;c.Actor.prototype.setScene=function(a){this.scene=a;this.properties.interactive&&a.interactiveNodes.push(this);this.all("children")&&this.all("children").each(function(b,d){d.setScene(a)})};c.Actor.prototype.add=function(a){this.set("children",this.childCount+=1,a);a.parent=this;return a};c.Actor.prototype.setScaleAndRotateAroundPos=function(a,b,d,e,f){this.matrix.reset();this.matrix.translate(e,f);this.matrix.scale(a,
b);this.matrix.translate(-e,-f)};c.Actor.prototype.setTranslation=function(a,b){this.matrix.reset();this.matrix.translate(a,b)};c.Actor.prototype.setScale=function(a,b){this.matrix.reset();this.matrix.scale(a,b)};c.Actor.prototype.setRotation=function(a){this.matrix.reset();this.matrix.rotate(a)};c.Actor.prototype.translate=function(a,b){this.matrix.translate(a,b);return this};c.Actor.prototype.scale=function(a,b){this.matrix.scale(a,b);return this};c.Actor.prototype.rotate=function(a){this.matrix.rotate(a);
return this};c.Actor.prototype.update=function(){};c.Actor.prototype.draw=function(){};c.Actor.prototype.checkActive=function(a,b,d){if(this.drawMask&&a.isPointInPath){this.drawMask(a);this.active=a.isPointInPath(b,d)?true:false}return false};c.Actor.prototype.preRender=function(){this.tmatrix=this.parent?new c.Matrix2D(this.parent.tmatrix):new c.Matrix2D;this.update();this.tmatrix.translate(this.p("x"),this.p("y"));this.tmatrix.rotate(this.p("rotation"));this.tmatrix.scale(this.p("scaleX"),this.p("scaleY"));
this.tmatrix.apply(this.matrix);this.all("children")&&this.all("children").each(function(a,b){b.preRender()})};c.Actor.prototype.render=function(a,b){if(this.p("visible")){var d=new c.Matrix2D(b);d.apply(this.tmatrix);a.setTransform(d.elements[0],d.elements[1],d.elements[3],d.elements[4],d.elements[2],d.elements[5]);this.p("interactive")&&this.checkActive(a,this.scene.displayX,this.scene.displayY);this.draw(a);this.all("children")&&this.all("children").each(function(e,f){f.render(a,b)})}};c.ZoomBehavior=
function(a){a.$canvas.bind("mousewheel",function(b,d){var e=1+0.02*d,f=a.scene.mouseX,h=a.scene.mouseY;a.matrix.translate(f,h);a.matrix.scale(e,e);a.matrix.translate(-f,-h)})};c.PanBehavior=function(a){var b=false,d,e,f=0,h=0,g=0,j=0;a.$canvas.bind("mousedown",function(){b=true;d=a.mouseX;e=a.mouseY;j=g=0});a.$canvas.bind("mouseup",function(){b=false});a.$canvas.bind("mousemove",function(){if(b){f=a.mouseX-d;h=a.mouseY-e;deltaX=f-g;deltaY=h-j;g=f;j=h;a.matrix.translate(deltaX,deltaY)}})};c.Display=
function(a,b){this.scene=a;this.$element=b.container;this.$canvas=$('<canvas width="'+b.width+'" height="'+b.height+'"></canvas>');this.width=b.width;this.height=b.height;this.$element.append(this.$canvas);this.ctx=this.$canvas[0].getContext("2d");this.matrix=new c.Matrix2D;if(b.zooming)this.zoombehavior=new c.ZoomBehavior(this);if(b.paning)this.panbehavior=new c.PanBehavior(this)};c.Display.prototype.refresh=function(){var a=this;this.$canvas.bind("mousemove",function(b){var d,e;if(b.offsetX){d=
b.offsetX;e=b.offsetY}else if(b.layerX){d=b.layerX;e=b.layerY}b=new c.Matrix2D(a.matrix);b.invert();var f=b.mult(new c.Vector(d,e));b=parseInt(f.x);f=parseInt(f.y);a.mouseX=d;a.mouseY=e;a.scene.mouseX=b;a.scene.mouseY=f;a.scene.displayX=d;a.scene.displayY=e});this.ctx.clearRect(0,0,this.width,this.height);this.ctx.fillStyle=this.scene.prop("fillStyle");this.ctx.fillRect(0,0,this.width,this.height);this.ctx.save();this.scene.all("children")&&this.scene.all("children").each(function(b,d){d.render(a.ctx,
a.matrix)});this.ctx.restore()};c.cmds={};c.cmds.RequestFramerate=function(a,b){this.scene=a;this.requests=0;this.framerate=b.framerate;this.originalFramerate=this.scene.framerate};c.cmds.RequestFramerate.className="RequestFramerate";c.cmds.RequestFramerate.prototype.execute=function(){this.requests+=1;this.scene.framerate=this.framerate};c.cmds.RequestFramerate.prototype.unexecute=function(){this.requests-=1;if(this.requests<=0)this.scene.framerate=this.originalFramerate};c.Scene=function(a){c.Actor.call(this);
_.extend(this.properties,{width:0,height:0,fillStyle:"#fff",element:"#canvas",framerate:10},a);this.mouseY=this.displayY=this.mouseX=this.displayX=-1;this.interactiveNodes=[];this.scene=this;this.commands={};this.displays=[];this.fps=0;this.framerate=this.p("framerate")};c.Scene.prototype=Object.extend(c.Actor);c.Scene.prototype.add=function(a){a.setScene(this);c.Actor.prototype.add.call(this,a);return a};c.Scene.prototype.add=function(a){this.set("children",this.childCount+=1,a);a.setScene(this);
return a};c.Scene.prototype.start=function(a){_.extend({framerate:50,idleFramerate:10},a);this.running=true;this.loop()};c.Scene.prototype.loop=function(){var a=this,b;if(this.running){b=(new Date).getTime();this.preRender();this.refreshDisplays();b=(new Date).getTime()-b;this.fps=1E3/b<a.framerate?1E3/b:a.framerate;setTimeout(function(){a.loop()},1E3/a.framerate-b)}};c.Scene.prototype.stop=function(){this.running=false};c.Scene.prototype.display=function(a){a=new c.Display(this,a);this.displays.push(a);
return a};c.Scene.prototype.register=function(a,b){this.commands[a.className]=new a(this,b)};c.Scene.prototype.execute=function(a){this.commands[a.className].execute()};c.Scene.prototype.unexecute=function(a){this.commands[a.className].unexecute()};c.Scene.prototype.refreshDisplays=function(){_.each(this.displays,function(a){a.refresh()})};c.Tween=function(a){this.prop=a.property;this.obj=a.obj;this._pos=this.begin=a.begin||a.obj[this.prop];this.setDuration(a.duration);this.func=a.easer||c.Tween.strongEaseInOut;
this.setFinish(a.finish||a.obj[this.prop]);this.callbacks={};this.callbacks.start=function(){};this.callbacks.finish=function(){}};c.Tween.prototype={obj:{},func:function(a,b,d,e){return d*a/e+b},begin:0,change:0,prevTime:0,prevPos:0,looping:false,_playing:false,_duration:0,_time:0,_pos:0,_position:0,_startTime:0,_finish:0,name:"",suffixe:"",on:function(a,b){this.callbacks[a]=b},setTime:function(a){this.prevTime=this._time;if(a>this.getDuration())if(this.looping){this.rewind(a-this._duration);this.update()}else{this._time=
this._duration;this.update();this.stop()}else{if(a<0)this.rewind();else this._time=a;this.update()}},getTime:function(){return this._time},setDuration:function(a){this._duration=a==null||a<=0?1E5:a},getDuration:function(){return this._duration},setPosition:function(a){this.prevPos=this._pos;this._pos=this.obj[this.prop]=a},getPosition:function(a){if(a==q)a=this._time;return this.func(a,this.begin,this.change,this._duration)},setFinish:function(a){this.change=a-this.begin},getFinish:function(){return this.begin+
this.change},isPlaying:function(){return this._playing},init:function(a,b,d,e,f,h){if(arguments.length){this._listeners=[];this.addListener(this);this.obj=a;this.prop=b;this._pos=this.begin=e;this.setDuration(h);if(d!=null&&d!="")this.func=d;this.setFinish(f)}},start:function(){this.rewind();this._playing=true;this.callbacks.start()},rewind:function(a){this.reset();this._time=a==q?0:a;this.fixTime();this.update()},fforward:function(){this._time=this._duration;this.fixTime();this.update()},update:function(){this.setPosition(this.getPosition(this._time))},
tick:function(){this._playing&&this.nextFrame()},nextFrame:function(){this.setTime((this.getTimer()-this._startTime)/1E3)},reset:function(){this._playing=false},stop:function(){this._playing=false;this.callbacks.finish()},continueTo:function(a,b){this.begin=this._pos;this.setFinish(a);this._duration!=q&&this.setDuration(b);this.start()},resume:function(){this.fixTime();this._playing=true},yoyo:function(){this.continueTo(this.begin,this._time)},fixTime:function(){this._startTime=this.getTimer()-this._time*
1E3},getTimer:function(){return(new Date).getTime()-this._time}};c.Tween.backEaseIn=function(a,b,d,e){if(f==q)var f=1.70158;return d*(a/=e)*a*((f+1)*a-f)+b};c.Tween.backEaseOut=function(a,b,d,e){if(f===q)var f=1.70158;return d*((a=a/e-1)*a*((f+1)*a+f)+1)+b};c.Tween.backEaseInOut=function(a,b,d,e){if(f==q)var f=1.70158;if((a/=e/2)<1)return d/2*a*a*(((f*=1.525)+1)*a-f)+b;return d/2*((a-=2)*a*(((f*=1.525)+1)*a+f)+2)+b};c.Tween.elasticEaseIn=function(a,b,d,e,f,h){if(a==0)return b;if((a/=e)==1)return b+
d;h||(h=e*0.3);if(!f||f<Math.abs(d)){f=d;d=h/4}else d=h/(2*Math.PI)*Math.asin(d/f);return-(f*Math.pow(2,10*(a-=1))*Math.sin((a*e-d)*2*Math.PI/h))+b};c.Tween.elasticEaseOut=function(a,b,d,e,f,h){if(a==0)return b;if((a/=e)==1)return b+d;h||(h=e*0.3);if(!f||f<Math.abs(d)){f=d;var g=h/4}else g=h/(2*Math.PI)*Math.asin(d/f);return f*Math.pow(2,-10*a)*Math.sin((a*e-g)*2*Math.PI/h)+d+b};c.Tween.elasticEaseInOut=function(a,b,d,e,f,h){if(a==0)return b;if((a/=e/2)==2)return b+d;h||(h=e*0.3*1.5);if(!f||f<Math.abs(d)){f=
d;var g=h/4}else g=h/(2*Math.PI)*Math.asin(d/f);if(a<1)return-0.5*f*Math.pow(2,10*(a-=1))*Math.sin((a*e-g)*2*Math.PI/h)+b;return f*Math.pow(2,-10*(a-=1))*Math.sin((a*e-g)*2*Math.PI/h)*0.5+d+b};c.Tween.bounceEaseOut=function(a,b,d,e){return(a/=e)<1/2.75?d*7.5625*a*a+b:a<2/2.75?d*(7.5625*(a-=1.5/2.75)*a+0.75)+b:a<2.5/2.75?d*(7.5625*(a-=2.25/2.75)*a+0.9375)+b:d*(7.5625*(a-=2.625/2.75)*a+0.984375)+b};c.Tween.bounceEaseIn=function(a,b,d,e){return d-Tween.bounceEaseOut(e-a,0,d,e)+b};c.Tween.bounceEaseInOut=
function(a,b,d,e){return a<e/2?Tween.bounceEaseIn(a*2,0,d,e)*0.5+b:Tween.bounceEaseOut(a*2-e,0,d,e)*0.5+d*0.5+b};c.Tween.strongEaseInOut=function(a,b,d,e){return d*(a/=e)*a*a*a*a+b};c.Tween.regularEaseIn=function(a,b,d,e){return d*(a/=e)*a+b};c.Tween.regularEaseOut=function(a,b,d,e){return-d*(a/=e)*(a-2)+b};c.Tween.regularEaseInOut=function(a,b,d,e){if((a/=e/2)<1)return d/2*a*a+b;return-d/2*(--a*(a-2)-1)+b};c.Tween.strongEaseIn=function(a,b,d,e){return d*(a/=e)*a*a*a*a+b};c.Tween.strongEaseOut=function(a,
b,d,e){return d*((a=a/e-1)*a*a*a*a+1)+b};c.Tween.strongEaseInOut=function(a,b,d,e){if((a/=e/2)<1)return d/2*a*a*a*a*a+b;return d/2*((a-=2)*a*a*a*a+2)+b};c.Bar=function(a){c.Actor.call(this,_.extend({width:30,height:50,strokeWeight:2,strokeStyle:"#000",fillStyle:"#ccc"},a))};c.Bar.prototype=Object.extend(c.Actor);c.Bar.prototype.drawMask=function(a){a.beginPath();a.moveTo(0,0);a.lineTo(this.properties.width,0);a.lineTo(this.properties.width,this.properties.height);a.lineTo(0,this.properties.height);
a.lineTo(0,0);a.closePath()};c.Bar.prototype.draw=function(a){a.fillStyle=this.prop("fillStyle");a.fillRect(0,0,this.prop("width"),this.prop("height"))};c.Label=function(a){c.Actor.call(this,_.extend({text:"",textAlign:"start",font:"12px Helvetica, Arial"},a))};c.Label.prototype=Object.extend(c.Actor);c.Label.prototype.draw=function(a){a.font=this.prop("font");a.fillStyle=this.prop("fillStyle");a.textAlign=this.prop("textAlign");a.fillText(this.prop("text"),0,0)};c.Dot=function(a){c.Actor.call(this,
_.extend({radius:20,strokeWeight:2,strokeStyle:"#ccc"},a))};c.Dot.prototype=Object.extend(c.Actor);c.Dot.prototype.draw=function(){};c.Visualization=new v({constructor:function(a,b){this.collection=a;this.measures=b.measures;this.params=b.params;this.$canvas=b.canvas||$("#canvas");this.margin={top:20,right:20,bottom:20,left:20}},isValid:function(){var a=this,b=0,d=true;$.each(this.constructor.spec.measures,function(e,f){var h;h=f.cardinality==="*"?a.measures.length-b:f.cardinality;for(var g=0;g<h;g++){var j;
j=f;var m=a.property(b);j=j.optional&&!m?true:m&&j.types.indexOf(m.type)>=0&&(m.unique===j.unique||j.unique===q);j||(d=false);b+=1}});return b>=this.measures.length?d:false},property:function(a){return this.collection.get("properties",this.measures[a])},render:function(){this.$canvas.html("render() is not implemented.")}});c.BarchartVis=c.Visualization.extend({constructor:function(a,b){c.Visualization.call(this,a,b);this.build()},build:function(){var a=this;data=pv.range(10).map(function(){return Math.random()+
0.1});this.items=this.collection.all("items");this.scene=new c.Scene({width:800,height:500});this.items.each(function(b,d){a.scene.add(new c.Bar({x:40+30*b,y:400,width:20,height:parseInt(-0.4*d.value("hardware_turnover"),10),fillStyle:"#7888ff",interactive:true}))})},render:function(){this.scene.start()},updateMeasure:function(a){var b=this;this.scene.all("children").each(function(d,e){e.p("height",parseInt(-0.4*b.items.at(d).value(a),10))})}});c.BarchartVis.spec={measures:[{types:["number"],unique:true,
cardinality:1},{types:["number"],unique:true,cardinality:"*"}]};c.Linechart=c.Visualization.extend({constructor:function(a,b){c.Visualization.call(this,a,b);this.margin={top:30,right:170,bottom:30,left:150}},render:function(){var a=this;this.isValid()?setTimeout(function(){a.renderChart()},1):this.$canvas.html("Cannot render. Change your settings.")},renderChart:function(){var a=this,b=this.$canvas.width()-this.margin.left-this.margin.right-20;height=this.$canvas.height()-this.margin.top-this.margin.bottom-
20;yProp=this.collection.get("properties",this.measures[0]);items=this.collection.all("items").values();yMax=yProp.aggregate(c.Aggregators.MAX);yMin=0;x=pv.Scale.ordinal(yProp.categories).split(0,b);y=pv.Scale.linear(yMin,yMax).range(0,height);i=-1;formatter=pv.Format.number();var d=pv.Scale.ordinal(_.map(items,function(f){return f.key})).range("#8DB5C8","#808E89","#B16649","#90963C","#A2C355","#93BAA1","#86A2A9"),e=(new pv.Panel).width(b).height(height).bottom(this.margin.bottom).top(this.margin.top).left(this.margin.left).right(this.margin.right).canvas(this.$canvas[0]);
(function(){e.add(pv.Rule).data(yProp.categories).strokeStyle("#eee").left(function(f){return x(f)}).add(pv.Label).bottom(-25).textAlign("center").text(function(f){return f}).textStyle(function(){return this.index===i?"#000":"#666"}).font("11px Helvetica");e.add(pv.Rule).data(y.ticks()).visible(function(){return!(this.index%2)}).bottom(function(f){return Math.round(y(f))-0.5}).strokeStyle("#eee").anchor("left").add(pv.Label).left(-10).text(function(f){return formatter.format(f.toFixed(1))}).textStyle("#666").font("11px Helvetica");
e.add(pv.Rule).bottom(0).strokeStyle("#777");e.add(pv.Rule).left(0).strokeStyle("#777");e.anchor("left").add(pv.Label).text(yProp.name).left(-70).textAngle(-Math.PI/2).textStyle("#777").textAlign("center").font("bold 13px Helvetica").add(pv.Label).left(-50).text(yProp.descr).textStyle("#aaa").font("10px Helvetica")})();(function(f){var h=e.add(pv.Panel).data(f).add(pv.Line).data(function(g){return g.values(a.measures[0]).values()}).left(function(){return x(yProp.categories[this.index])}).bottom(function(g){return y(g)}).strokeStyle(function(){return d(this.parent.data().key)}).lineWidth(3);
h.add(pv.Dot).fillStyle(function(){return this.index===i?"#fff":h.strokeStyle()}).strokeStyle(function(){return this.index===i?h.strokeStyle():null}).size(function(){return this.index===i?30:20}).lineWidth(3)})(items);(function(f){e.add(pv.Panel).right(-a.margin.right).width(150).top(0).add(pv.Dot).data(f).top(function(){return this.index*30}).size(70).strokeStyle(null).fillStyle(function(h){return d(h.key)}).anchor("right").add(pv.Label).left(10).text(function(h){return h.identify()}).textStyle("#666").font("11px Helvetica").add(pv.Label).left(80).text(function(h){return h.values(a.measures[0]).values()[i]})})(items);
(function(){e.add(pv.Bar).fillStyle("rgba(0,0,0,.001)").event("mouseout",function(){i=-1;e.render()}).event("mousemove",function(){i=pv.search(x.range(),e.mouse().x);i=i<0?-i-2:i;e.render()})})();e.render()}});c.Linechart.spec={measures:[{types:["number"],unique:false,cardinality:1}]};c.Scatterplot=c.Visualization.extend({constructor:function(a,b){c.Visualization.call(this,a,b);this.margin={top:30,right:0,bottom:50,left:150};this.itemValueIndex=0;var d=this,e=this.collection.get("properties",this.measures[0]);
if(e.unique===false){var f=$('<div class="settings"><h4>Time</h4><input id="item_value_index" type="range" min="0" max="'+(e.categories.length-1)+'" value="'+this.itemValueIndex+'"><br/><h2 id="current-category">'+e.categories[this.itemValueIndex]+"</span></h2>");$("#info").append(f);$("#item_value_index").change(function(){if(d.itemValueIndex!==$(this).val()){d.itemValueIndex=$(this).val();$("#current-category").html(e.categories[d.itemValueIndex]);d.render()}})}},render:function(){var a=this;this.isValid()?
setTimeout(function(){a.renderChart()},1):this.$canvas.html("Cannot render. Change your settings.")},renderChart:function(){function a(){var l=this.transform().invert().translate(0,0),u;l.y=-l.y;u=l.translate(r(j),s(o));l=l.translate(r(m),s(k));r.domain(r.invert(u.x),r.invert(l.x));s.domain(s.invert(u.y),s.invert(l.y));t.render()}var b=this,d=this.$canvas.width()-this.margin.left-this.margin.right-200,e=this.$canvas.height()-this.margin.top-this.margin.bottom-20,f=this.collection.get("properties",
this.measures[0]),h=this.collection.get("properties",this.measures[1]),g=this.collection.get("properties",this.measures[2]),j=f.aggregate(c.Aggregators.MIN),m=f.aggregate(c.Aggregators.MAX),o=h.aggregate(c.Aggregators.MIN),k=h.aggregate(c.Aggregators.MAX),n,p,r,s,z,C=pv.Format.number();r=pv.Scale.linear(j,m).range(0,d).nice();s=pv.Scale.linear(o,k).range(0,e).nice();if(g){n=g.aggregate(c.Aggregators.MIN);p=g.aggregate(c.Aggregators.MAX);z=pv.Scale.linear(n,p).range(5,15)}n=this.collection.all("items").values();
var A=pv.Scale.ordinal(_.map(n,function(l){return l.key})).range("#8DB5C8","#808E89","#B16649","#90963C","#A2C355","#93BAA1","#86A2A9"),t=(new pv.Panel).width(d).height(e).bottom(this.margin.bottom).top(this.margin.top).left(this.margin.left).right(this.margin.right).strokeStyle("#ccc").canvas(this.$canvas[0]);t.add(pv.Rule).data(function(){return r.ticks()}).strokeStyle(function(l){return l?"#eee":"#999"}).left(function(l){return parseInt(r(l),10)+0.5}).anchor("bottom").add(pv.Label).text(r.tickFormat).textStyle("#777").font("11px Helvetica");
t.add(pv.Rule).data(function(){return s.ticks()}).strokeStyle(function(l){return l?"#eee":"#999"}).bottom(function(l){return parseInt(s(l),10)+0.5}).anchor("left").add(pv.Label).text(s.tickFormat).textStyle("#777").font("11px Helvetica");t.add(pv.Label).text(f.name).left(d/2).bottom(-35).textStyle("#555").font("bold 14px Helvetica");t.add(pv.Label).text(h.name).left(-110).top(e/2).textAngle(-Math.PI/2).textStyle("#555").font("bold 14px Helvetica");t.add(pv.Panel).overflow("hidden").data(n).add(pv.Panel).def("active",
false).event("mousedown",pv.Behavior.pan()).event("mousewheel",pv.Behavior.zoom()).event("pan",a).event("zoom",a).add(pv.Dot).left(function(l){return r(l.values(f.key).at(b.itemValueIndex))}).bottom(function(l){return s(l.values(h.key).at(b.itemValueIndex))}).radius(function(l){return g?z(l.values(g.key).at(b.itemValueIndex)):10}).fillStyle(function(l){return this.parent.active()?"#fff":A(l.key)}).strokeStyle(function(l){return this.parent.active()?A(l.key):null}).lineWidth(4).event("mouseover",function(){return this.parent.active(true)}).event("mouseout",
function(){return this.parent.active(false)}).anchor("top").add(pv.Label).text(function(l){var u=l.identify();if(g)u+=" / "+g.name+": "+C.format(l.values(g.key).at(b.itemValueIndex));return u}).font("12px Helvetica").textStyle("#666").visible(function(){return this.parent.active()});t.render()}});c.Scatterplot.spec={measures:[{types:["number"],cardinality:2},{types:["number"],cardinality:1,optional:true}]};c.Stacks=c.Visualization.extend({constructor:function(a,b){c.Visualization.call(this,a,b);this.margin=
{top:30,right:40,bottom:30,left:150};this.build()},computeCols:function(a,b,d){for(var e=1,f,h;;){f=b/e;h=Math.ceil(a/e);if(h*f<=d&&a*f*f<=b*d)return e;else e+=1}},prepareProperty:function(){this.property=this.collection.get("properties",this.measures[0]);this.propertyValues=this.property.all("values");this.stackWidth=parseInt(this.width/this.property.all("values").length,10);this.stackColors=pv.Scale.ordinal(this.propertyValues.values()).range("#8DB5C8","#808E89","#B16649","#90963C","#A2C355","#93BAA1",
"#86A2A9");var a=0;this.propertyValues.each(function(b,d){a=Math.max(a,d.all("items").length)});this.cols=this.computeCols(a,this.stackWidth,this.height)},addStacks:function(){var a=this;this.propertyValues.each(function(b,d){a.scene.add(new c.Stacks.Stack({items:d.all("items"),scene:a.scene,stacks:a,x:b*a.stackWidth,cols:a.cols,index:b,width:a.stackWidth,height:a.height,fillStyle:a.stackColors(d.val).color,name:d.val}))});this.scene.add(new c.Label({x:a.width,y:20,font:"12px Helvetica Neue, Helvetica, Arial",
text:function(){return"FPS: "+parseInt(a.scene.framerate)},textAlign:"right",fillStyle:"black"}))},build:function(){this.width=this.$canvas.width()-10;this.height=this.$canvas.height()-10;this.stackItems=new c.SortedHash;this.scene=new c.Scene({fillStyle:"#fff"});this.scene.register(c.cmds.RequestFramerate,{framerate:50});this.prepareProperty();this.addStacks()},zoom:function(a){this.scene.scale(a,a)},changeGroup:function(a){this.measures=[a];this.prepareProperty();this.scene.replace("children",new c.SortedHash);
this.addStacks()},render:function(){var a=this.scene;a.display({container:$("#canvas"),width:this.width,height:this.height,paning:true,zooming:true});a.start()}});c.Stacks.Stack=function(a){c.Actor.call(this);_.extend(this.properties,{width:30,height:50,strokeStyle:"#000",fillStyle:"#aaa"},a);this.build()};c.Stacks.Stack.prototype=Object.extend(c.Actor);c.Stacks.Stack.prototype.build=function(){var a=this,b=parseInt(this.p("width")/this.p("cols"),10),d=0;this.p("items").eachKey(function(e,f){var h=
parseInt(d/a.p("cols"),10),g;g=new c.Stacks.Item({x:Math.random()*400,y:Math.random()*600,size:1,fillStyle:function(){return this.active?"#ccc":a.p("fillStyle")},interactive:true,item:f});g.key=e;g.p("scene",a.p("scene"));g.updateX(b*(d%a.p("cols"))+a.p("index")*a.p("width"));g.updateY(a.p("height")-100-h*b);g.updateSize(b-1);a.p("scene").add(g);d+=1});this.add(new c.Label({x:a.p("width")/2,y:a.p("height")-20,font:"11px Helvetica Neue, Helvetica, Arial",text:function(){return a.p("name")},textAlign:"center",
fillStyle:"#333"}))};c.Stacks.Stack.prototype.draw=function(){};c.Stacks.Item=function(a){var b=this;c.Bar.call(this);_.extend(this.properties,{size:10,name:"Unknown"},a);this.ts=new c.Tween({obj:this.properties,property:"size",duration:2});this.tx=new c.Tween({obj:this.properties,property:"x",duration:2});this.ty=new c.Tween({obj:this.properties,property:"y",duration:2});this.ts.on("start",function(){b.p("scene").execute(c.cmds.RequestFramerate)});this.ts.on("finish",function(){b.p("scene").unexecute(c.cmds.RequestFramerate)});
this.build()};c.Stacks.Item.prototype=Object.extend(c.Bar);c.Stacks.Item.prototype.build=function(){var a=this,b=new c.Bar({x:-200,y:0,width:200,height:50,fillStyle:"#eee",visible:function(){return a.active?true:false}});b.add(new c.Label({x:10,y:20,font:"bold 15px Helvetica Neue, Helvetica, Arial",text:function(){return a.p("item").identify()},textAlign:"left",fillStyle:"#333"}));this.add(b)};c.Stacks.Item.prototype.updateX=function(a){this.tx.continueTo(a,1.5)};c.Stacks.Item.prototype.updateY=function(a){this.ty.continueTo(a,
1.5)};c.Stacks.Item.prototype.updateSize=function(a){this.ts.continueTo(a,1.5)};c.Stacks.Item.prototype.update=function(){this.tx.tick();this.ty.tick();this.ts.tick()};c.Stacks.Item.prototype.draw=function(a){a.fillStyle=this.p("fillStyle");a.fillRect(0,0,this.p("size"),this.p("size"))};c.Stacks.Item.prototype.drawMask=function(a){a.beginPath();a.moveTo(0,0);a.lineTo(this.p("size"),0);a.lineTo(this.p("size"),this.p("size"));a.lineTo(0,this.p("size"));a.lineTo(0,0);a.closePath()};c.Stacks.spec={measures:[{types:["number"],
unique:false,cardinality:1}]};c.Table=c.Visualization.extend({constructor:function(a,b){c.Visualization.call(this,a,b);this.build()},build:function(){},render:function(){this.$canvas.html(this.renderCollection(this.collection))},renderItem:function(a,b){var d=this;str="<tr>";a.all("properties").eachKey(function(e){if(b.type(e)==="collection")str+="<td>"+d.renderCollection(b.first(e))+"</td>";else{str+="<td>";b.values(e).each(function(f,h){str+=h+"<br/>"});str+="</td>"}});str+="</tr>";return str},
renderCollection:function(a){var b=this;str="<table><thead><tr>";a.all("properties").each(function(d,e){str+="<th>"+e.name+"</th>"});str+="</tr></thead><tbody>";a.all("items").each(function(d,e){str+=b.renderItem(a,e)});str+="</tbody></table>";return str}});c.Table.spec={measures:[{types:["number","string","date"],unique:true,cardinality:1,optional:true}]};B.uv=c})(window);
